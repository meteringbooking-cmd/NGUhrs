<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management | NGU-hrs</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
               background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
               min-height:100vh; padding:20px; }
        .container { max-width:1400px; margin:0 auto; }

        header { background:rgba(255,255,255,0.95); padding:25px 30px;
                 border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.2);
                 margin-bottom:30px; display:flex; justify-content:space-between;
                 align-items:center; }
        .header-left h1 { color:#667eea; font-size:2.2em; font-weight:700; }
        .header-left p { color:#666; margin-top:5px; }
        .back-btn { background:linear-gradient(135deg,#667eea,#764ba2);
                    color:white; padding:12px 25px; border:none; border-radius:8px;
                    cursor:pointer; font-size:1em; transition:transform .2s;
                    text-decoration:none; display:inline-block; }
        .back-btn:hover { transform:translateY(-2px);
                          box-shadow:0 5px 15px rgba(0,0,0,0.2); }

        .search-section { background:rgba(255,255,255,0.95); padding:25px;
                          border-radius:15px; box-shadow:0 8px 25px rgba(0,0,0,0.15);
                          margin-bottom:25px; }
        .search-box { display:flex; gap:15px; align-items:center; flex-wrap:wrap; }
        .search-box input { flex:1; min-width:250px; padding:12px 20px;
                            border:2px solid #e0e0e0; border-radius:8px;
                            font-size:1em; transition:border .3s; }
        .search-box input:focus { outline:none; border-color:#667eea; }

        .tabs { display:flex; gap:5px; margin-bottom:20px; flex-wrap:wrap; }
        .tab-btn { background:#f1f3f5; color:#555; padding:10px 16px;
                   border:none; border-radius:8px; cursor:pointer;
                   font-size:0.95em; font-weight:600; transition:all .3s; }
        .tab-btn.active { background:#667eea; color:white; }
        .tab-btn:hover { background:#d5d9eb; }
        .tab-btn.active:hover { background:#5a6fd8; }

        .content-area { display:grid; grid-template-columns:1fr; gap:25px; }

        .eligibility-table {
            background:rgba(255,255,255,0.95);
            border-radius:15px;
            padding:25px;
            box-shadow:0 8px 25px rgba(0,0,0,0.15);
            overflow-x:auto;
        }
        .eligibility-table h2 {
            margin-bottom:20px; color:#333; font-size:1.4em;
            display:flex; justify-content:space-between; align-items:center;
        }
        table {
            width:100%; border-collapse:collapse; min-width:1400px;
        }
        th, td {
            padding:14px 12px; text-align:center; border-bottom:1px solid #e0e0e0;
        }
        th {
            background:#f8f9fa; color:#444; font-weight:600;
            font-size:0.85em; text-transform:uppercase; letter-spacing:0.5px;
        }
        th:first-child { text-align:left; }
        td:first-child {
            text-align:left; font-weight:600; color:#333;
            white-space:nowrap;
        }
        .employee-name { font-size:1em; }
        .employee-id { font-size:0.8em; color:#777; display:block; }

        input[type="checkbox"] {
            transform:scale(1.2); cursor:pointer;
        }
        input[type="checkbox"]:checked {
            accent-color:#667eea;
        }

        .save-btn {
            background:#28a745; color:white; padding:10px 20px;
            border:none; border-radius:8px; cursor:pointer;
            font-weight:600; margin-top:20px; float:right;
        }
        .save-btn:hover { background:#218838; }

        .btn-success {
            background:#28a745; color:white; padding:8px 16px;
            border:none; border-radius:8px; cursor:pointer;
            font-weight:600; font-size:0.9em;
        }

        .no-access {
            text-align:center; padding:60px 20px; color:#666;
        }
        .no-access-icon { font-size:4em; margin-bottom:15px; }

        @media (max-width:768px) {
            .tabs { justify-content:center; }
            table { font-size:0.8em; }
            th, td { padding:10px 6px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>Management</h1>
                <p>Manage employee access & permissions</p>
            </div>
            <a href="index.html" class="back-btn">Back to Dashboard</a>
        </header>

        <!-- ADD EMPLOYEE BUTTON -->
        <div style="text-align:center; margin:20px 0;">
            <button onclick="addNewEmployee()" class="btn-success">
                + Add New Employee
            </button>
        </div>

        <div class="search-section">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:15px;">
                <div class="search-box" style="flex:1; min-width:250px;">
                    <input type="text" id="searchInput" placeholder="Search employees..." onkeyup="filterTable()">
                </div>
            </div>
        </div>

        <div class="content-area">
            <div id="eligibility" class="tab-content active">
                <div class="eligibility-table">
                    <h2>Employee Section Eligibility
                        <button onclick="addNewEmployee()" class="btn-success">+ Add</button>
                    </h2>

                    <table id="eligibilityTable">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>View All</th>
                                <th>View All – Office</th>
                                <th>View All – None Office</th>
                                <th>Employee Files</th>
                                <th>Reports</th>
                                <th>Management</th>
                                <th>Mandatory Docs</th>
                                <th>Application</th>
                                <th>Cognito Forms</th>
                                <th>Add'l Payments</th>
                                <th>Bonus</th>
                                <th>Absence</th>
                                <th>Absence Office</th>
                                <th>Holiday</th>
                                <th>Holiday Office</th>
                            </tr>
                        </thead>
                        <tbody id="permissionsBody">
                            <!-- DYNAMIC ROWS WILL BE ADDED HERE -->
                        </tbody>
                    </table>
                    <button class="save-btn" onclick="savePermissions()">Save Permissions</button>
                </div>
            </div>

            <div id="management" class="tab-content">
                <div class="no-access" id="accessDenied" style="display:none;">
                    <div class="no-access-icon">Lock</div>
                    <h3>Access Denied</h3>
                    <p>You do not have permission to view this section.</p>
                </div>
                <div id="managementContent" style="display:none;">
                    <h3>Management Dashboard</h3>
                    <p>Only users with <strong>Management</strong> access can view this.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="employees.js"></script>
    <script>
        // Section groups
        const officeSections = ['employee-files', 'reports', 'management', 'mandatory-docs', 'application', 'absence-office', 'holiday-office'];
        const noneOfficeSections = ['bonus', 'additional-payments', 'cognito-forms', 'absence', 'holiday'];

        // === 1. Add New Employee ===
        function addNewEmployee() {
            const name = prompt("Enter employee name:");
            if (!name || name.trim() === "") return alert("Name is required");

            const emp = EMPLOYEES.add(name.trim());
            alert(`Added: ${emp.name} (ID: ${emp.id})`);
            renderPermissionsTable();
        }

        // === 2. Render Permissions Table ===
        function renderPermissionsTable() {
            EMPLOYEES.init();
            const tbody = document.getElementById('permissionsBody');
            tbody.innerHTML = '';

            EMPLOYEES.data.forEach((emp, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="employee-name">${emp.name}</div>
                        <div class="employee-id">ID: ${emp.id}</div>
                    </td>
                    <td><input type="checkbox" class="view-all" data-emp="${emp.id}"></td>
                    <td><input type="checkbox" class="view-all-office" data-emp="${emp.id}"></td>
                    <td><input type="checkbox" class="view-all-none-office" data-emp="${emp.id}"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="employee-files"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="reports"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="management"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="mandatory-docs"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="application"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="cognito-forms"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="additional-payments"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="bonus"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="absence"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="absence-office"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="holiday"></td>
                    <td><input type="checkbox" data-emp="${emp.id}" data-section="holiday-office"></td>
                `;
                tbody.appendChild(row);
            });

            // Re-attach event listeners
            attachCheckboxListeners();
            loadPermissions();
        }

        // === 3. Attach Checkbox Listeners ===
        function attachCheckboxListeners() {
            // View All – Office
            document.querySelectorAll('.view-all-office').forEach(cb => {
                cb.addEventListener('change', function() {
                    const emp = this.dataset.emp;
                    const isChecked = this.checked;
                    officeSections.forEach(sec => {
                        const box = document.querySelector(`input[data-emp="${emp}"][data-section="${sec}"]`);
                        if (box) box.checked = isChecked;
                    });
                    syncAllCheckboxes();
                });
            });

            // View All – None Office
            document.querySelectorAll('.view-all-none-office').forEach(cb => {
                cb.addEventListener('change', function() {
                    const emp = this.dataset.emp;
                    const isChecked = this.checked;
                    noneOfficeSections.forEach(sec => {
                        const box = document.querySelector(`input[data-emp="${emp}"][data-section="${sec}"]`);
                        if (box) box.checked = isChecked;
                    });
                    syncAllCheckboxes();
                });
            });

            // View All (all sections)
            document.querySelectorAll('.view-all').forEach(cb => {
                cb.addEventListener('change', function() {
                    const emp = this.dataset.emp;
                    const isChecked = this.checked;
                    document.querySelectorAll(`input[data-emp="${emp}"][data-section]`).forEach(box => {
                        box.checked = isChecked;
                    });
                    syncAllCheckboxes();
                });
            });

            // Individual changes
            document.querySelectorAll('input[data-section]').forEach(cb => {
                cb.addEventListener('change', syncAllCheckboxes);
            });
        }

        // === 4. Load Permissions ===
        function loadPermissions() {
            const saved = localStorage.getItem('employeePermissions');
            if (!saved) return;
            const perms = JSON.parse(saved);
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                const emp = cb.dataset.emp;
                const sec = cb.dataset.section;
                if (sec && perms[emp]?.[sec] !== undefined) {
                    cb.checked = perms[emp][sec];
                }
            });
            syncAllCheckboxes();
        }

        // === 5. Save Permissions ===
        function savePermissions() {
            const perms = {};
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                const emp = cb.dataset.emp;
                const sec = cb.dataset.section;
                if (sec && emp) {
                    if (!perms[emp]) perms[emp] = {};
                    perms[emp][sec] = cb.checked;
                }
            });
            localStorage.setItem('employeePermissions', JSON.stringify(perms));
            alert('Permissions saved successfully!');
        }

        // === 6. Sync Master Checkboxes ===
        function syncAllCheckboxes() {
            document.querySelectorAll('.view-all, .view-all-office, .view-all-none-office').forEach(master => {
                const emp = master.dataset.emp;
                let targetSections = [];
                if (master.classList.contains('view-all-office')) targetSections = officeSections;
                else if (master.classList.contains('view-all-none-office')) targetSections = noneOfficeSections;
                else targetSections = [...officeSections, ...noneOfficeSections];

                const checkboxes = targetSections.map(sec => 
                    document.querySelector(`input[data-emp="${emp}"][data-section="${sec}"]`)
                ).filter(Boolean);

                const allChecked = checkboxes.every(cb => cb.checked);
                const anyChecked = checkboxes.some(cb => cb.checked);
                master.indeterminate = anyChecked && !allChecked;
                master.checked = allChecked;
            });
        }

        // === 7. Search ===
        function filterTable() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('#eligibilityTable tbody tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(term) ? '' : 'none';
            });
        }

        // === 8. Tab Logic ===
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const tab = document.getElementById(tabName);
            tab.classList.add('active');
            if (event && event.target) event.target.classList.add('active');

            if (tabName === 'management') {
                const currentUserId = 'EMP001'; // Change to test
                const perms = JSON.parse(localStorage.getItem('employeePermissions') || '{}');
                if (perms[currentUserId]?.['management']) {
                    document.getElementById('managementContent').style.display = 'block';
                    document.getElementById('accessDenied').style.display = 'none';
                } else {
                    document.getElementById('managementContent').style.display = 'none';
                    document.getElementById('accessDenied').style.display = 'block';
                }
            }
        }

        // === 9. ON LOAD ===
        window.onload = function() {
            renderPermissionsTable();
            openTab('eligibility');
        };
    </script>
</body>
</html>
